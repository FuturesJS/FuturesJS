// promise, future, deliver, fulfill
var provide=provide||function(){};(function(){function e(a){return new d(a)}function d(d){function s(a,b){var c={};b.forEach(function(b){c[b]=function(){a[b].apply(a,arguments);return c}});return c}function r(a,b){var c;Object.keys(e).forEach(function(f){var g=e[f];a===g.callback&&(b===g.context||g.context===d)&&(c=g)});return c}function q(){var a={},b={};g=0,Object.keys(e).forEach(function(c){var d=a[g]=e[c];f[c]&&(b[g]=!0),d.id=g,g+=1}),f=b,e=a}function p(){l&&(clearTimeout(l),l=undefined),i>0&&(l=setTimeout(function(){o.deliver(new c(i)),l=undefined},i))}var e={},f={},g=0,h=0,i=0,j,k,l,m=!0,n,o=this;d="undefined"==typeof d?null:d,o.isFuture=b,o.setContext=function(a){d=a},o.setTimeout=function(a){i=a,p()},o.errback=function(){arguments.length<2?o.deliver.call(o,arguments[0]||new Error("`errback` called without Error")):o.deliver.apply(o,arguments)},o.callback=function(){var a=Array.prototype.slice.call(arguments);a.unshift(undefined),o.deliver.apply(o,a)},o.callbackCount=function(){return Object.keys(e).length},o.deliveryCount=function(){return h},o.setAsap=function(a){undefined===a&&(a=!0);if(!0!==a&&!1!==a)throw new Error("Future.setAsap(asap) accepts literal true or false, not "+a);m=a},o.hasCallback=function(){return!!r.apply(o,arguments)},o.removeCallback=function(a,b){var c=r(a,b);c&&(delete e[c.id],f[c.id]=undefined,delete f[c.id]);return o},o.deliver=function(){if(j)throw new Error("`Future().fulfill(err, data, ...)` renders future deliveries useless");var a=Array.prototype.slice.call(arguments);k=a,h+=1,Object.keys(e).forEach(function(b){var c=e[b],d=c.callback,g=c.context;f[b]&&(delete e[b],delete f[b]),d.apply(g,a)}),a[0]&&"FutureTimeout"!==a[0].name&&p();return o},o.fulfill=function(){arguments.length?o.deliver.apply(o,arguments):o.deliver(),j=!0},o.whenever=function(b,c){var i=g,j;if("function"!=typeof b)throw new Error("Future().whenever(callback, [context]): callback must be a function.");if(r(b,c))throw new Error("Future().everytimers is a strict set. Cannot add already subscribed `callback, [context]`.");j=e[i]={id:i,callback:b,context:null===c?null:c||d},m&&h>0&&(j.callback.apply(j.context,k),f[i]&&(delete f[i],delete e[i])),g+=1,g>=a&&q();return o},o.when=function(a,b){f[g]=!0,o.whenever(a,b);return o},n=s(o,["when","whenever"]),o.passable=function(){return n}}function c(a){this.name="FutureTimeout",this.message="timeout "+a+"ms"}function b(a){return a instanceof d}"use strict";var a=Math.pow(2,52);e.isFuture=b,module.exports=e,provide("futures/future")})();var provide=provide||function(){},__dirname=__dirname||"";(function(){function d(a){return new c(a)}function c(b){function l(){var a=g?"when":"whenever";h=!0,d=Array(f.length),e=Array(f.length),f.forEach(function(a,b){a.whenever(function(){var a=Array.prototype.slice.call(arguments);d[b]=a,e[b]||(e[b]=!0,i+=1),k()})})}function k(){var a;!!h&&i===d.length&&(i=0,j.deliver.apply(j,d),d=Array(d.length),e=Array(e.length))}var c=this,d=[],e=[],f=[],g=!1,h=!1,i=0,j=a(b);b=b||null,c.deliverer=function(){var b=a();c.add(b);return b.deliver},c.when=function(){h||l(),j.when.apply(j,arguments)},c.whenever=function(){h||l(),j.whenever.apply(j,arguments)},c.add=function(){if(h)throw new Error("`Join().add(Array<future> | subs1, [subs2, ...])` requires that all additions be completed before the first `when()` or `whenever()`");var a=Array.prototype.slice.call(arguments);a=Array.isArray(a[0])?a[0]:a,a.forEach(function(a){a.whenever||(g=!0);if(!a.when)throw new Error("`Join().add(future)` requires either a promise or future");f.push(a)})}}function b(a){return a instanceof c}"use strict";var a=require((__dirname?__dirname+"/":"futures")+"/future");d.isJoin=b,module.exports=d,provide("futures/join")})();var provide=provide||function(){};(function(){function c(a){return new b(a)}function b(a){function f(){var a=Array.prototype.slice.call(arguments),b=e.shift();d=arguments;b?(a.unshift(f),b.callback.apply(b.context,a)):c=!0}var b=this,c=!0,d,e=[];a=a||null,b.then=function(g,h){if("function"!=typeof g)throw new Error("`Sequence().then(callback [context])` requires that `callback` be a function and that `context` be `null`, an object, or a function");e.push({callback:g,context:null===h?null:h||a,index:e.length}),c&&(c=!1,f.apply(null,d));return b}}function a(a){return a instanceof b}"use strict",c.isSequence=a,module.exports=c,provide("futures/sequence")})();var __dirname=__dirname||"",provide=provide||function(){};(function(){function b(b,c){function e(a,b,e){d.then(function(d){c(d,a,b,e)})}var d=a();b.forEach(e);return d}"use strict";var a=require((__dirname?__dirname+"/":"futures")+"/sequence");module.exports=b,provide("futures/forEachAsync-standalone",module.exports)})(),function(){function b(b,c){function f(){var a="undefined"!=typeof c?c:this,f,g;d.setContext(a);try{g=b.apply(a,arguments)}catch(h){f=h}d.deliver(f,g);return e}var d=a(),e=d.passable();d.setAsap(!1),f.when=e.when,f.whenever=e.whenever;return f}"use strict",require("require-kiss");var a=require((__dirname?__dirname+"/":"futures")+"/future");module.exports=b,provide("futures/asyncify",module.exports)}();var provide=provide||function(){},__dirname=__dirname||"";(function(){function d(c,d,e,f,g){function j(d,e){return function(){var g=Array.prototype.slice.call(arguments),h=a(),j=b();g.unshift(h.deliver),d.apply(f,g),j.then(h.when);return i(c[e],j)}}function i(a,b){function g(a,d){return function(){var e=Array.prototype.slice.call(arguments);b.then(function(){var b=Array.prototype.slice.call(arguments),c=[],g=b.shift();b.forEach(function(a){c.push(a)}),e.forEach(function(a){c.push(a)}),e=undefined,d?(a.apply(f,c),g.apply(null,b)):(c.unshift(g),a.apply(f,c))});return c}}var c={};Object.keys(d).forEach(function(a){c[a]=g(d[a])}),Object.keys(e).forEach(function(a){c[a]=g(e[a],!0)});return c}var h={};"undefined"==typeof f&&(f=null),Object.keys(c).forEach(function(a){h[a]=j(c[a],a)});return h}function c(a,b){"undefined"!=typeof b&&("function"==typeof b.when?b.when(a):"function"==typeof b?b(a):a(b))}"use strict";var a=require((__dirname?__dirname+"/":"futures")+"/future"),b=require((__dirname?__dirname+"/":"futures")+"/sequence");module.exports=d,provide("futures/chainify")})();var provide=provide||function(){},__dirname=__dirname||"";(function(){function e(a){return new d(a)}function d(d){function q(){n=Array.prototype.slice.call(arguments);"break"===n[0]?(n.shift(),f.deliver.apply(f,n)):p()}function p(){var a=Math.max(g-(c()-j),0);isNaN(a)&&(a=g);if(!l){if(i&&h>=i){f.deliver(new b(i));return}n.unshift(q),setTimeout(function(){j=c();try{o.apply(d,n),h+=1}catch(a){console.log("I'm an error");throw a}},a)}}var e=this,f=a(),g=0,h=0,i=0,j,k,l,m,n,o;e.setMaxLoop=function(a){i=a;return e},e.setWait=function(a){g=a;return e},e.setTimeout=function(a){if(k)throw new Error("Can't set timeout, the loop has already begun!");k=a;var b=setTimeout(function(){l=!0,f.deliver(new Error("LoopTimeout"))},k);f.when(function(){clearTimeout(b)});return e},e.run=function(a){n=Array.prototype.slice.call(arguments),o=a,n[0]=undefined,q.apply(e,n);return e},e.when=f.when,e.whenever=f.whenever}function c(){return(new Date).valueOf()}function b(a){this.name="MaxCountReached",this.message="Loop looped "+a+" times"}"use strict";var a=require((__dirname?__dirname+"/":"futures")+"/future");module.exports=e,provide("futures/loop")})();var provide=provide||function(){},__dirname=__dirname||"";(function(){function b(){var a="You have upgraded to Futures 2.x. See http://github.com/coolaj86/futures for details.";console.log(a);throw new Error(a)}"use strict";var a;__dirname?a=__dirname:a="futures",module.exports={promise:b,subscription:b,synchronize:b,whilst:b,future:require(a+"/future"),forEachAsync:require(a+"/forEachAsync-standalone"),sequence:require(a+"/sequence"),join:require(a+"/join"),asyncify:require(a+"/asyncify"),loop:require(a+"/loop"),chainify:require(a+"/chainify")},provide("futures")})()